<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; font-weight:704; color:#333333;">Многие новички Linux оставляют у себя на компьютере второй запасной операционной системой Windows. Но при переходе то в одну, то во вторую систему наблюдается неприятный момент - время начинает &quot;убегать&quot; на несколько часов то вперед, то назад. Это происходит потому, что Linux и Window хранят время в разных форматах.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">    В компьютере используется два вида часов. Первые - аппаратные часы, которые идут всегда, даже тогда, когда компьютер выключен (питаются от батарейки на материнской плате компьютера). Вторые часы - программные. Вот именно этими часами пользуется операционная система. При включении компьютера первоначальное время берется из аппаратных часов и записывается в программные часы. И вся проблема как раз в том, что разные операционные системы по-разному работают с программными часами. Есть два варианта работы:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px; font-weight:704;">UTC</span><span style=" font-size:20px;"> - аппаратные и программные часы идут по Гринвичу. И эти часы дают универсальное время с нулевым смещением (нулевой часовой пояс). А уже локально к этому времени прибавляется ваш часовой пояс (с плюсом или минусом). Чаще всего так время идет на серверах, с которыми потом синхронизируются рабочие станции пользователей и уже локально у всех пользователей происходит поправка на их часовой пояс.</span></li>
<li style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px; font-weight:704;">Localtime</span><span style=" font-size:20px;"> - в данном случае программные часы тоже идут по Гринвичу, а вот аппаратные часы идут по времени локального часового пояса. Пользователь особой разницы не заметит, т.к. все равно нужно добавлять или вычитать поправку на свой часовой пояс. И вот тут появляется проблема. Windows при загрузке и(или) синхронизации времени делает поправку на часовой пояс пользователя для того, чтобы программное время было верным. В Linux не так.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="yandex_rtb_R-A-475274-1"></a><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">И</span><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">менно поэтому, при каждой перезагрузке из одной системы в другую будет происходить смещение времени на величину поправки на часовой пояс. И единственный способ это устранить - это заставить обе системы (и Windows, и Linux) работать со временем в одном формате. Сделать это можно двумя путями:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">Заставить Windows работать по UTC, как Linux;</span></li>
<li style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:20px;">Заставить Linux работать в формате localtime.</span></li></ol>
<h2 style=" margin-top:36px; margin-bottom:18px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:110%; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; font-weight:504; color:#333333; background-color:#ffffff; text-transform:uppercase;">ПЕРЕКЛЮЧЕНИЕ WINDOWS НА РАБОТУ ПО UTC</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Для решения проблемы сбивающегося времени достаточно добавить всего один ключ в реестр Windows. Это можно сделать с помощью ввода команды в консоли.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Чтобы открыть консоль от имени администратора в Windows 10 нужно поставить курсор мыши в левый нижний угол экрана и нажать правую кнопку мыши. В появившемся контекстном меню нужно выбрать &quot;Командная строка (администратор)&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Для 32-х битной Windows вводим (это одна команда, вводится в одну строку):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">Reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Для</span><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#ff0000; background-color:#ffffff;"> 64-х</span><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;"> битных нужно ввести (это одна команда, вводится в одну строку):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">Reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_QWORD /d 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Однако, это еще не все. Служба времени Windows все равно продолжит сохранять время в старом формате при его обновлении через Интернет. Поэтому, службу нужно отключить. Либо это сделать руками через &quot;Панель управления&quot; Windows, либо быстрее и проще в той же командной строке, запущенной от имени администратора, выполнить:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">sc config w32time start=disabled</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; font-weight:600; color:#333333; background-color:#ffffff; text-transform:uppercase;">КАК ВЕРНУТЬ НАСТРОЙКИ ВРЕМЕНИ В WINDOWS ОБРАТНО?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">В командной строке, запущенной от имени администратора, выполняем (это одна команда, вводится в одну строку):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">Reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">и запускаем службу синхронизации времени Windows:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">sc config w32time start=demand</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans Serif'; font-size:9pt;"><br /></span></p>
<hr />
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">По умолчанию Linux хранит временя в формате UTC, но можно переключить систему так, чтобы она хранила в аппаратном таймере местное время. Рассмотрим на примере Ubuntu-Linux (работает даже в старых версиях, например в 16.04).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Чтобы посмотреть текущее состояние аппаратных и программных часов, нужно выполнить:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">timedatectl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Roboto Condensed','Helvetica Neue','Helvetica','Arial','sans-serif'; font-size:9pt; color:#333333; background-color:#ffffff;">Начнем исправлять проблему сбивающихся часов. Для этого выполняем команду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#f0f0f0;">sudo timedatectl set-local-rtc 1 --adjust-system-clock</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo','Monaco','Consolas','Courier New','monospace'; font-size:9pt; font-weight:704; color:#423fff; background-color:#ffffff;"><br /></p></body></html>