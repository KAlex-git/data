<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:130%; background-color:#ffffff;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:9pt; font-weight:496; color:#333333;">Resolve IP адресов в Linux: понятное и детальное описание</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/nix/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#5e6973; background-color:#000000;">*nix *</span></a><a href="https://habr.com/ru/hub/s_admin/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#5e6973; background-color:#000000;">Серверное администрирование *</span></a><a href="https://habr.com/ru/hub/ipv6/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#5e6973; background-color:#000000;">IPv6 *</span></a><a href="https://habr.com/ru/hub/linux_dev/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#5e6973; background-color:#000000;">Разработка под Linux *</span></a><a href="https://habr.com/ru/hub/devops/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:496; text-decoration: underline; color:#5e6973; background-color:#000000;">DevOps *</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:156%; background-color:#ffffff;"><a name="post-content-body"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Н</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">астройка сетевого взаимодействия сервисов не самая простая задача и часто осуществляется без глубокого понимания как требуется настраивать систему и какие настройки на что влияют. После миграции сервисов в docker контейнерах с centos 6 на centos 7 я столкнулся со странным поведением вебсервера: он пытался присоединиться к сервису по IPv6, а сервис же слушал только IPv4 адрес. Стандартный совет в такой ситуации — отключить поддержку IPv6. Но это не поможет в ряде случаев. Каких? В этой статье я задался целью собрать и детально объяснить как приложения </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">resolve</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">'ят адреса.</span><a name="habracut"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Публикация будет полезна начинающим администраторам и разработчикам.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:transparent;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111; background-color:transparent;">Прочитав эту статью, вы узнаете:</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">какой алгоритм в Linux для резолва хостнеймов;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">как переопределить логику определения хостнеймов;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">какие функции и библиотеки использует ОС;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">какие ловушки существуют при конфигурировании и как их не допускать;</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1641325195dn43k0pfwj.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">У операционной системы Linux есть несколько источников для определения адреса по hostname. Весь необходимый функционал для определения находится в </span><a href="https://www.gnu.org/software/libc/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">GNU C Library (glibc)</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. glibc является по-сути фреймворком и реализовывает множество полезных функций для разработчика, предоставляя свой API для упрощения разработки. Среди прочего, glibc имплементирует </span><a href="http://pubs.opengroup.org/onlinepubs/9699919799/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">POSIX</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Такие функции как </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">open</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">read</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">write</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">malloc</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">printf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">dlopen</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">pthread_create</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">crypt</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">login</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">exit</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> для Linux систем предоставляет именно glibc.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Известные многим утилиты </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">host</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">dig</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">nslookup</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> используют glibc, но поставляются отдельно.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:transparent;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111; background-color:transparent;">А еще я веду телеграм канал</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> </span><a href="https://t.me/noTieInIT"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">Об IT без галстуков</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><a href="http://dmenshikov.com/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">блог</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. На канале рассказываю о проблемах менеджмента и как их решать, пишу о принципах мышления при решении бизнес задач, о том как стать эффективным и высокоплачиваемым специалистом.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Теперь, когда у разработчика есть возможность вызвать функцию семейства </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> из glibc для определения адреса, то возникает потребность конфигурировать возвращаемые значения. Например, использовать ли сперва </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> или запрос к DNS-серверу. В glibc подобное конфигурирование производится с помощью схемы под названием </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">Name Service Switch</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> (NSS).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Если объяснять на пальцах, то NSS позволяет задавать базы данных и очередность поиска в этих базах для предоставления сервиса. В нашем случае, сервис — это поиск по hostname, а базой данных может выступать </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> или DNS сервер. Это не единственный сервис настраиваемый посредством NSS, предоставляются сервисы mail алиасов, сервис поиска пользователей и групп. Ознакомится со списком можно </span><a href="https://www.gnu.org/software/libc/manual/html_node/NSS-Basics.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">в руководстве</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Благодаря NSS можно без пересборки приложений, в рантайме, конфигурировать упомянутые базы данных. Производится конфигурирование в файле </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Ниже пример конфига из стандартного </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> в Centos 7.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ grep ^hosts /etc/nsswitch.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">hosts:      files dns myhostname</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">files</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> являются алиасами баз данных для поиска. </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">files</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> на большинстве систем подразумевает использование </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> база — это DNS-сервер к которому будет осуществляться запрос поиска hostname, а </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> — это самая необычная база, о существовании которой мало кто знает и она не является частью стандартной поставки в glibc. В некоторых дистрибутивах присутствует еще и база </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">mdns4_minimal</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Ниже по тексту предоставлен разбор этих баз данных.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Базы используются в том порядке в котором они обьявлены в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и если в текущей базе запись найдена, то происходит выход из цепочки и возврат результата. При отсутствии результата происходит переход к следующей базе в списке. Если ни в одной базе не найден результат, то такой ответ и дается на запрос glibc функции </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Поведение перехода к следующей базе и условия такого перехода можно дополнительно конфигурировать, например, при недоступности DNS (не путать с отсутствием записи) завершить цепочку. Понятное и простое объяснение принципа настройки условий для </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> даны </span><a href="http://searchitchannel.techtarget.com/feature/Using-nsswitchconf-to-find-Linux-system-information"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">в этой статье</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">База </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">files</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, а в частности </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, из коробки в Centos 7 выглядит следующим образом:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/hosts</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Можно отметить, что для </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">localhost</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> имеются две записи: IPv4 и IPv6 адрес. Это может сыграть злую шутку и в конце материала я расскажу почему.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">База </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> при определении адреса использует name server указанный в конфиге </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/resolv.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Вот пример моего </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/resolv.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> на хост системе:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/resolv.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"># Generated by NetworkManager</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">nameserver 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">nameserver 192.168.100.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Name server'а используются тоже по цепочке и в порядке их объявления. В моем случае, первым выступает локальный DNS сервер (я использую </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">dnsmasq</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">) для задания локальных адресов </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">.priv</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> зон. Если находится совпадение, то возвращается адрес из локальной сети. Все остальные запросы отправляются на основной DNS сервер с адресом </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">192.168.100.1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">База </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> присутствует в поставке Centos и Ubuntu, но не является частью </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">glibc</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Не зная этого факта я потратил много времени пытаясь выяснить почему мне возвращаются IPv6 адреса для определения хоста. Он работает следующим образом:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">При запросе локального хостнейма (того что возвращает команда </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">hostname</span><span style=" font-size:medium;">) плагин возвращает все IP адреса публичных интерфейсов (т.е. все кроме loopback), при отсутствии таких интерфейсов возвращается IPv4 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">127.0.0.2</span><span style=" font-size:medium;"> и IPv6 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">::1</span><span style=" font-size:medium;">;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">При запросе хостнейма </span><span style=" font-size:medium; font-weight:600;">localhost</span><span style=" font-size:medium;"> или </span><span style=" font-size:medium; font-weight:600;">localhost.localdomain</span><span style=" font-size:medium;"> возвращает IPv4 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">127.0.0.1</span><span style=" font-size:medium;"> и IPv6 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">::1</span><span style=" font-size:medium;">;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">При запросе хостнейма оканчивающегося на </span><span style=" font-size:medium; font-weight:600;">.localhost</span><span style=" font-size:medium;"> или </span><span style=" font-size:medium; font-weight:600;">.localhost.localdomain</span><span style=" font-size:medium;"> возвращает IPv4 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">127.0.0.1</span><span style=" font-size:medium;"> и IPv6 адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:medium; background-color:#fafafa;">::1</span><span style=" font-size:medium;">;</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.freedesktop.org/software/systemd/man/nss-myhostname.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">В мануале</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> еще пишут про особую логику с обработкой хостнейма </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">_gateway</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, но видимо это какой-то патч, так как с Centos 7 у меня он не завелся.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">База </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">mdns4_minimal</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> или же </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">mdns_minimal</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> требуется для корректной работы Avahi. При необходимости можно обратиться к </span><a href="https://wiki.archlinux.org/index.php/avahi"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">документации Arch по Avahi</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, где коротко и понятно дана информация<br />по использованию.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Теперь, когда дана информация по базам и принципам их работы стоит отметить отличия в определении адресов в разных инструментах, что приводит к проблемам в рантайме.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Обычно администраторы проверяют хостнейм используя команду </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">host</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Это некорректно, так host, как и dig, используют только DNS резолвинг, но не используют NSS. Nginx, например, использует функцию </span><a href="http://man7.org/linux/man-pages/man3/getaddrinfo.3.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">getaddrinfo</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, а она использует NSS. Это приводит к тому, что вбитый в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> хостнейм может работать с nginx, но не резолвится иными способами. Куда хуже, когда в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> вбиты IPv6 адрес для хостнейма, а в настройках DNS возвращается только IPv4 адрес. В этом случае, администратор может проверить что команда host возвращает только IPv4 адрес и успокоится, а потом приложение использующее </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> из glibc запустится и найдет для того же хостнейма IPv4 и IPv6 адрес. Источник ошибок…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Для проверки результатов возвращаемой каждой из баз документация рекомендует воспользоваться утилитой </span><a href="http://man7.org/linux/man-pages/man1/getent.1.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">getent</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Ниже немного примеров работы с </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getent</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> с включенным IPv6.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">В </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> содержится следующая цепочка баз:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">hosts:      files dns myhostname</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">В </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> содержится следующее инфо</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/hosts</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1    localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1          localhost ip6-localhost ip6-loopback</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Команда </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getent ahosts &lt;hostname&gt;</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> покажет список всех адресов которые удалось найти. С такими настройками она выведет следующее:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Команда позволяет точечно опросить конкретную базу и выяснить что срезолвит база. Рассмотрим для каждой базы возвращаемые значения:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:files ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:dns ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:myhostname ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Если убрать из </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> строки для localhost, то вывод видоизменится:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:files ahosts localhost</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:dns ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:myhostname ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1             RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Теперь база </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> возвращает ответы, а база </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">files</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> не содержит данных. Для DNS запросов используется неймсервер конфигурируемый в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/resolv.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> в моем контейнере, например</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/resolv.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">nameserver 127.0.0.11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">options ndots:0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">На хост машине установлен </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">dnsmasq</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> который проксирует и кэширует ответы DNS серверов. Ответ от DNS будет зависеть от настроек DNS сервера к которому поступил запрос. </span><a href="https://www.ietf.org/rfc/rfc1912.txt"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">RFC 1912</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> рекомендует в пункте 4.1 сконфигурировать DNS сервера таким образом, чтобы localhost указывал на 127.0.0.1.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:transparent;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111; background-color:transparent;">Certain zones should always be present in nameserver configurations:</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">       primary         localhost               localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">       primary         0.0.127.in-addr.arpa    127.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">       primary         255.in-addr.arpa        255</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">       primary         0.in-addr.arpa          0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /><br />These are set up to either provide nameservice for &quot;special&quot;<br />addresses, or to help eliminate accidental queries for broadcast or<br />local address to be sent off to the root nameservers. All of these<br />files will contain NS and SOA records just like the other zone files<br />you maintain, the exception being that you can probably make the SOA<br />timers very long, since this data will never change.<br /><br />The &quot;localhost&quot; address is a &quot;special&quot; address which always refers to<br />the local host. It should contain the following line:<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  localhost.      IN      A       127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">В моем случае, dnsmasq из коробки содержит записи для localhost, как и рекомендует RFC.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ dig +noall +answer localhost ANY @127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">localhost.      0   IN  A       127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">localhost.      0   IN  AAAA    ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Отключается это либо удалением записей из </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> на самом DNS сервере, либо же включением опции </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">no-hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/dnsmasq.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">После включения опции getent для базы </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> вернет непустой результат, но как и отмечалось выше, с включенным </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> будет возвращаться IPv4 и IPv6 адрес. На системах со статическими IP адресами можно смело выключить </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> плагин и конфигурировать локальные хосты с использованием </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Альтернативный вариант — это отключение IPv6.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Статус IPv6 на сервере можно получить из параметров ядра. Значение 0 возвращается при включенном IPv6, а 1 при выключенном.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl net.ipv6.conf.all.disable_ipv6 net.ipv6.conf.default.disable_ipv6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">net.ipv6.conf.all.disable_ipv6 = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">net.ipv6.conf.default.disable_ipv6 = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">В выводе </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">ifconfig</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> интерфейсы слушающие IPv6 содержат строчку </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">inet6</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Ниже пример вывода с выключенным и включенным IPv6 соответственно:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"># diabled</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ ifconfig -a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet 192.168.101.5  netmask 255.255.255.0  broadcast 0.0.0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        ether 02:42:c0:a8:65:05  txqueuelen 0  (Ethernet)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX packets 15789549  bytes 2553533549 (2.3 GiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX packets 9783999  bytes 1318627420 (1.2 GiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet 127.0.0.1  netmask 255.0.0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        loop  txqueuelen 1  (Local Loopback)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX packets 606047  bytes 67810892 (64.6 MiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX packets 606047  bytes 67810892 (64.6 MiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"># enabled</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ ifconfig -a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet 192.168.101.5  netmask 255.255.255.0  broadcast 0.0.0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet6 fe80::42:c0ff:fea8:6505  prefixlen 64  scopeid 0x20&lt;link&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        ether 02:42:c0:a8:65:05  txqueuelen 0  (Ethernet)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX packets 15787641  bytes 2553216408 (2.3 GiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX packets 9782965  bytes 1318487919 (1.2 GiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet 127.0.0.1  netmask 255.0.0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        loop  txqueuelen 1  (Local Loopback)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX packets 605949  bytes 67799887 (64.6 MiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        RX errors 0  dropped 0  overruns 0  frame 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX packets 605949  bytes 67799887 (64.6 MiB)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Выключить IPv6 можно вызовом</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.all.disable_ipv6=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.default.disable_ipv6=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Что изменится после выключения? Я откатил все конфиги на стандартные: в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> присутствует localhost с адресами IPv4 и IPv6, в dnsmasq выключена опция </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">no-hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Отключил IPv6 командами выше и вывод getent стал следующим:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:files ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:dns ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ getent -s hosts:myhostname ahosts localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       STREAM localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       DGRAM</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1       RAW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Воу, в первом выводе у нас дублируется адрес 127.0.0.1. Чтобы разобраться почему так происходит стоит обратиться к исходному коду glibc и к коду утилиты getent. Ниже кусок кода утилиты getent.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">/* This is for hosts, but using getaddrinfo */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">static int</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">ahosts_keys_int (int af, int xflags, int number, char *key[])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  // ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  hint.ai_flags = (AI_V4MAPPED | AI_ADDRCONFIG | AI_CANONNAME</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">           | idn_flags | xflags);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  hint.ai_family = af;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  for (i = 0; i &lt; number; ++i)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      struct addrinfo *res;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      if (getaddrinfo (key[i], NULL, &amp;hint, &amp;res) != 0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    result = 2;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      struct addrinfo *runp = res;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      while (runp != NULL)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">          // printf goes here</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">      freeaddrinfo (res);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  return result;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Флаг </span><a href="http://man7.org/linux/man-pages/man3/getaddrinfo.3.html"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">AI_V4MAPPED функции getaddrinfo</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> производит маппинг IPv6 адресов на IPv4 если не были найдены IPv6 адреса в результате опроса базы. Флаг AI_ADDRCONFIG вынудит getaddrinfo проверить наличие IPv6/IPv4 адресов сконфигурированных в системе и в случае отсутствия хотя бы одного IPv6/IPv4 адреса не будет возвращаться IPv6/IPv4 независимо от того что ответит конкретная база.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Поскольку у getent включены оба флага, а в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> присуствуетя для localhost адреса </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">127.0.0.1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, то getaddrinfo получит из NSS базы </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> (в примере выше мы обсуждали именно эту базу), адреса </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">127.0.0.1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, затем не обнаружив ни одного IPv6 адреса в системе (выключены параметрами ядра) и произведет маппинг </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> -&gt; </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">127.0.0.1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Чтобы лучше понять эту концепцию, приведу примеры с выводом getaddrinfo на той же системе, с разными настройками </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">ai_flags</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">ai_family</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. В </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> включены для localhost IPv4 и IPv6 адреса.<br />Исходный код можно найти </span><a href="https://gist.github.com/WoZ/70f90bc053d2718d6311682525430b72"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; text-decoration: underline; color:#548eaa; background-color:#000000;">на моем github</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;"># ./getaddrinfo localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">IP addresses for localhost:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::ffff:127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::ffff:127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Из вывода видно, что с _ai</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">family</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> равным _AI</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-style:italic; color:#111111;">UNSPEC</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> (возвращать и IPv4, и IPv6) и без AI_ADDRCONFIG флага </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> возвращает два адреса, IPv4 и IPv6, что многие администраторы не ожидают увидеть. Это происходит независимо от того выключен ли IPv6 в параметрах ядра. Если в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> убрать адрес </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, то из вывода </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> (с флагом </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">AF_UNSPEC</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">) вовсе исчезнут IPv6 адреса.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">С включенным IPv6 и наличием </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> будет возвращаться IPv4 и IPv6. Для предотвращения возврата адреса IPv6 требуется закомментировать IPv6 адрес в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">. Если адреса будут найдены в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, то в </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">myhostname</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> базу glibc не полезет.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Осталось проверить как ведет себя </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> для </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> базы. Для этого оставлю в </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> для </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">hosts</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> только </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; font-weight:600; color:#111111;">dns</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> базу и порезолвлю google.com. Вывод ниже с включенным IPv6.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.default.disable_ipv6=0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.all.disable_ipv6=0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ ./getaddrinfo google.com</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">IP addresses for google.com:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::ffff:216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::ffff:216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">А вот вывод с выключенным IPv6:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.all.disable_ipv6=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl -w net.ipv6.conf.default.disable_ipv6=1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ ./getaddrinfo google.com</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">IP addresses for google.com:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::ffff:216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">getaddrinfo: Name or service not known</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: 2a00:1450:401b:806::200e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 216.58.215.78</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">--------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Как видно, ситуация с AI_ADDRCONFIG очень похожа.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Напоследок приведу пример как не учитывая все вышесказанное вляпаться в проблемы. IPv6 включен, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">/etc/nsswitch.conf</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> стандартный.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/hosts</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">127.0.0.1   localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">::1         localhost ip6-localhost ip6-loopback</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ grep hosts /etc/nsswitch.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">hosts:      files dns myhostname</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ cat /etc/resolv.conf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">nameserver 127.0.0.11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">options ndots:0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ sysctl net.ipv6.conf.all.disable_ipv6 net.ipv6.conf.default.disable_ipv6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">net.ipv6.conf.all.disable_ipv6 = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">net.ipv6.conf.default.disable_ipv6 = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Что вернет </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">host localhost</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> или </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">dig ANY localhost</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">? Что вернет </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">getaddrinfo</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, например, с флагами как у nginx?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ dig +noall +answer ANY localhost @127.0.0.11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">localhost.      0   IN   A    127.0.0.1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ host localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">localhost has address 127.0.0.1</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">$ ./getaddrinfo localhost</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">IP addresses for localhost:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c; background-color:#fbfdff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">[AF_UNSPEC] AI_ADDRCONFIG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv6: ::1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%; background-color:#fbfdff;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#4d4d4c;">  IPv4: 127.0.0.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">nginx будет пытаться подключаться к двум адресам: </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">127.0.0.1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"> и </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,Courier,monospace'; font-size:9pt; color:#111111; background-color:#fafafa;">::1</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">, а приложение может и не ожидать такого. Источник для ошибок.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1641325195jg0uus1z2g.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;">Какой можно сделать вывод из всего написанного?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;"><br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:12px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">Если вы разрабатываете приложение работающее с сетью, то учитывайте, что IPv6 может быть отключен;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">При настройке сервера учитывайте наличие NSS и очередности проверок, используйте getent или мой код для проверки;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">Если неизвестно как работает приложение, то при наличии исходных кодов можно посмотреть с какими флагами резолвятся<br />адреса и сверить с настройками системы;</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:9pt; color:#111111;" style=" margin-top:6px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:160%;"><span style=" font-size:medium;">Если исходных кодов нет, то можно по поведению в выводе strace сделать предположение об используемых флагах.</span></li></ol></body></html>